<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AML Risk Assessment Tool</title>
    <style>
        :root {
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --header-bg: #2d2d2d;
            --orange-primary: #ff6d00;
            --orange-light: #ff9e40;
            --orange-dark: #c43e00;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #333333;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background-color: var(--header-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: var(--orange-primary);
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            background-color: var(--orange-primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: var(--orange-light);
            transform: translateY(-2px);
        }

        button.secondary {
            background-color: var(--card-bg);
            border: 1px solid var(--orange-primary);
        }

        .client-info {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        input, select {
            background-color: #2d2d2d;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px;
            border-radius: 5px;
            font-size: 1rem;
        }

        .risk-factors {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .factors-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .factors-table th {
            background-color: var(--header-bg);
            color: var(--orange-primary);
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--orange-primary);
        }

        .factors-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .factors-table tr:hover {
            background-color: rgba(255, 109, 0, 0.1);
        }

        .editable {
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }

        .editable:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .low-risk {
            color: var(--success);
        }

        .medium-risk {
            color: var(--warning);
        }

        .high-risk {
            color: var(--danger);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-row > div {
            flex: 1;
        }

        .risk-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .sdd {
            background-color: var(--success);
            color: white;
        }

        .cdd {
            background-color: var(--warning);
            color: white;
        }

        .edd {
            background-color: var(--danger);
            color: white;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .summary {
                grid-template-columns: 1fr;
            }
            
            .factors-table {
                font-size: 0.8rem;
            }
            
            .factors-table th,
            .factors-table td {
                padding: 8px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AML Risk Assessment Tool</h1>
            <div class="controls">
                <button id="editBtn">Edit Factors</button>
                <button id="addFactorBtn">Add New Factor</button>
                <button id="resetBtn" class="secondary">Reset</button>
            </div>
        </header>

        <section class="client-info">
            <h2>Client Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label for="clientName">Client Name</label>
                    <input type="text" id="clientName" value="PCI Africa">
                </div>
                <div class="info-item">
                    <label for="assessmentDate">Assessment Date</label>
                    <input type="date" id="assessmentDate" value="2026-01-13">
                </div>
                <div class="info-item">
                    <label for="facilityAmount">Facility Amount</label>
                    <input type="number" id="facilityAmount" value="2000000">
                </div>
            </div>
        </section>

        <section class="risk-factors">
            <h2>Risk Factor Assessment</h2>
            <table class="factors-table">
                <thead>
                    <tr>
                        <th>Risk Factor</th>
                        <th>Input Value</th>
                        <th>Risk Score</th>
                        <th>Weight</th>
                        <th>Weighted Score</th>
                    </tr>
                </thead>
                <tbody id="factorsTableBody">
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
        </section>

        <section class="summary">
            <div class="summary-card">
                <h3>Total Weighted Score</h3>
                <div class="score-value" id="totalScore">1.20</div>
            </div>
            <div class="summary-card">
                <h3>Final Risk Score</h3>
                <div class="score-value low-risk" id="riskLevel">LOW</div>
                <div class="risk-indicator sdd">SDD</div>
            </div>
            <div class="summary-card">
                <h3>Risk Percentage</h3>
                <div class="score-value" id="riskPercentage">39.17%</div>
            </div>
        </section>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Edit Risk Factor</h2>
            <form id="editForm">
                <input type="hidden" id="editIndex">
                <div class="form-group">
                    <label for="factorName">Risk Factor Name</label>
                    <input type="text" id="factorName" required>
                </div>
                <div class="form-group">
                    <label for="inputValue">Input Value</label>
                    <input type="text" id="inputValue" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="riskScore">Risk Score (1-5)</label>
                        <select id="riskScore" required>
                            <option value="1">1 - Low</option>
                            <option value="2">2 - Medium-Low</option>
                            <option value="3">3 - Medium</option>
                            <option value="4">4 - Medium-High</option>
                            <option value="5">5 - High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="weight">Weight (0.01-1.00)</label>
                        <input type="number" id="weight" min="0.01" max="1.00" step="0.01" required>
                    </div>
                </div>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Add Factor Modal -->
    <div id="addFactorModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Add New Risk Factor</h2>
            <form id="addFactorForm">
                <div class="form-group">
                    <label for="newFactorName">Risk Factor Name</label>
                    <input type="text" id="newFactorName" required>
                </div>
                <div class="form-group">
                    <label for="newInputValue">Input Value</label>
                    <input type="text" id="newInputValue" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newRiskScore">Risk Score (1-5)</label>
                        <select id="newRiskScore" required>
                            <option value="1">1 - Low</option>
                            <option value="2">2 - Medium-Low</option>
                            <option value="3">3 - Medium</option>
                            <option value="4">4 - Medium-High</option>
                            <option value="5">5 - High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newWeight">Weight (0.01-1.00)</label>
                        <input type="number" id="newWeight" min="0.01" max="1.00" step="0.01" required>
                    </div>
                </div>
                <button type="submit">Add Factor</button>
            </form>
        </div>
    </div>

    <script>
        // Sample data based on the documents
        let riskFactors = [
            { name: "Facility Amount", inputValue: "2,000,000.00", riskScore: 1, weight: 0.08, weightedScore: 0.08 },
            { name: "Nature of Business Relationship", inputValue: "Long-standing", riskScore: 1, weight: 0.03, weightedScore: 0.03 },
            { name: "Company Operating History", inputValue: ">5 years", riskScore: 1, weight: 0.03, weightedScore: 0.03 },
            { name: "Legal Entity Type", inputValue: "Private Company", riskScore: 2, weight: 0.05, weightedScore: 0.10 },
            { name: "Industry / Sector Risk", inputValue: "Project Management & Contracting", riskScore: 1, weight: 0.05, weightedScore: 0.05 },
            { name: "Travel Destination Risk", inputValue: "Mixed travel including moderate-risk regions", riskScore: 2, weight: 0.08, weightedScore: 0.15 },
            { name: "Sanctions & Whitelist Checks", inputValue: "No Hits", riskScore: 1, weight: 0.25, weightedScore: 0.25 },
            { name: "Politically Exposed Persons (PEPs) & Related Parties", inputValue: "No PEP involvement", riskScore: 1, weight: 0.25, weightedScore: 0.25 },
            { name: "Negative Media & Reputation Check", inputValue: "Clean media profile", riskScore: 1, weight: 0.10, weightedScore: 0.10 },
            { name: "UBO Transparency", inputValue: "UBOs fully disclosed and verified", riskScore: 1, weight: 0.10, weightedScore: 0.10 },
            { name: "Ownership Structure Complexity", inputValue: "Simple direct ownership", riskScore: 1, weight: 0.05, weightedScore: 0.05 }
        ];

        // DOM Elements
        const factorsTableBody = document.getElementById('factorsTableBody');
        const totalScoreElement = document.getElementById('totalScore');
        const riskLevelElement = document.getElementById('riskLevel');
        const riskPercentageElement = document.getElementById('riskPercentage');
        const editModal = document.getElementById('editModal');
        const addFactorModal = document.getElementById('addFactorModal');
        const editForm = document.getElementById('editForm');
        const addFactorForm = document.getElementById('addFactorForm');
        const editBtn = document.getElementById('editBtn');
        const addFactorBtn = document.getElementById('addFactorBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Initialize the application
        function init() {
            renderFactorsTable();
            calculateScores();
            attachEventListeners();
        }

        // Render the factors table
        function renderFactorsTable() {
            factorsTableBody.innerHTML = '';
            riskFactors.forEach((factor, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" data-index="${index}" data-field="name">${factor.name}</td>
                    <td class="editable" data-index="${index}" data-field="inputValue">${factor.inputValue}</td>
                    <td class="editable" data-index="${index}" data-field="riskScore">${factor.riskScore}</td>
                    <td class="editable" data-index="${index}" data-field="weight">${factor.weight.toFixed(2)}</td>
                    <td>${factor.weightedScore.toFixed(2)}</td>
                `;
                factorsTableBody.appendChild(row);
            });

            // Add event listeners to editable cells
            document.querySelectorAll('.editable').forEach(cell => {
                cell.addEventListener('click', handleCellEdit);
            });
        }

        // Calculate scores
        function calculateScores() {
            let totalWeightedScore = 0;
            riskFactors.forEach(factor => {
                factor.weightedScore = factor.riskScore * factor.weight;
                totalWeightedScore += factor.weightedScore;
            });

            const riskPercentage = (totalWeightedScore / (riskFactors.length * 5)) * 100;

            totalScoreElement.textContent = totalWeightedScore.toFixed(2);
            riskPercentageElement.textContent = riskPercentage.toFixed(2) + '%';

            // Determine risk level
            let riskLevel, riskClass, dueDiligence;
            if (totalWeightedScore < 1.5) {
                riskLevel = "LOW";
                riskClass = "low-risk";
                dueDiligence = "SDD";
            } else if (totalWeightedScore < 3.0) {
                riskLevel = "MEDIUM";
                riskClass = "medium-risk";
                dueDiligence = "CDD";
            } else {
                riskLevel = "HIGH";
                riskClass = "high-risk";
                dueDiligence = "EDD";
            }

            riskLevelElement.textContent = riskLevel;
            riskLevelElement.className = "score-value " + riskClass;
            
            // Update due diligence indicator
            const indicator = document.querySelector('.risk-indicator');
            indicator.className = "risk-indicator " + dueDiligence.toLowerCase();
            indicator.textContent = dueDiligence;
        }

        // Handle cell editing
        function handleCellEdit(event) {
            const index = event.target.dataset.index;
            const field = event.target.dataset.field;
            const currentValue = riskFactors[index][field];
            
            const newValue = prompt(`Edit ${field}:`, currentValue);
            if (newValue !== null) {
                // Validate numeric inputs
                if ((field === 'riskScore' || field === 'weight') && isNaN(newValue)) {
                    alert('Please enter a valid number');
                    return;
                }
                
                if (field === 'riskScore') {
                    const score = parseInt(newValue);
                    if (score < 1 || score > 5) {
                        alert('Risk Score must be between 1 and 5');
                        return;
                    }
                    riskFactors[index][field] = score;
                } else if (field === 'weight') {
                    const weight = parseFloat(newValue);
                    if (weight < 0.01 || weight > 1.00) {
                        alert('Weight must be between 0.01 and 1.00');
                        return;
                    }
                    riskFactors[index][field] = weight;
                } else {
                    riskFactors[index][field] = newValue;
                }
                
                renderFactorsTable();
                calculateScores();
            }
        }

        // Open edit modal
        function openEditModal(index) {
            const factor = riskFactors[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('factorName').value = factor.name;
            document.getElementById('inputValue').value = factor.inputValue;
            document.getElementById('riskScore').value = factor.riskScore;
            document.getElementById('weight').value = factor.weight.toFixed(2);
            editModal.style.display = 'flex';
        }

        // Open add factor modal
        function openAddFactorModal() {
            document.getElementById('newFactorName').value = '';
            document.getElementById('newInputValue').value = '';
            document.getElementById('newRiskScore').value = '1';
            document.getElementById('newWeight').value = '0.05';
            addFactorModal.style.display = 'flex';
        }

        // Close modals
        function closeModals() {
            editModal.style.display = 'none';
            addFactorModal.style.display = 'none';
        }

        // Attach event listeners
        function attachEventListeners() {
            // Edit button
            editBtn.addEventListener('click', () => {
                alert('Click on any cell in the table to edit its value directly.');
            });

            // Add factor button
            addFactorBtn.addEventListener('click', openAddFactorModal);

            // Reset button
            resetBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all data?')) {
                    // Reload sample data
                    riskFactors = [
                        { name: "Facility Amount", inputValue: "2,000,000.00", riskScore: 1, weight: 0.08, weightedScore: 0.08 },
                        { name: "Nature of Business Relationship", inputValue: "Long-standing", riskScore: 1, weight: 0.03, weightedScore: 0.03 },
                        { name: "Company Operating History", inputValue: ">5 years", riskScore: 1, weight: 0.03, weightedScore: 0.03 },
                        { name: "Legal Entity Type", inputValue: "Private Company", riskScore: 2, weight: 0.05, weightedScore: 0.10 },
                        { name: "Industry / Sector Risk", inputValue: "Project Management & Contracting", riskScore: 1, weight: 0.05, weightedScore: 0.05 },
                        { name: "Travel Destination Risk", inputValue: "Mixed travel including moderate-risk regions", riskScore: 2, weight: 0.08, weightedScore: 0.15 },
                        { name: "Sanctions & Whitelist Checks", inputValue: "No Hits", riskScore: 1, weight: 0.25, weightedScore: 0.25 },
                        { name: "Politically Exposed Persons (PEPs) & Related Parties", inputValue: "No PEP involvement", riskScore: 1, weight: 0.25, weightedScore: 0.25 },
                        { name: "Negative Media & Reputation Check", inputValue: "Clean media profile", riskScore: 1, weight: 0.10, weightedScore: 0.10 },
                        { name: "UBO Transparency", inputValue: "UBOs fully disclosed and verified", riskScore: 1, weight: 0.10, weightedScore: 0.10 },
                        { name: "Ownership Structure Complexity", inputValue: "Simple direct ownership", riskScore: 1, weight: 0.05, weightedScore: 0.05 }
                    ];
                    renderFactorsTable();
                    calculateScores();
                }
            });

            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', closeModals);
            });

            // Close modals when clicking outside
            window.addEventListener('click', (event) => {
                if (event.target === editModal) closeModals();
                if (event.target === addFactorModal) closeModals();
            });

            // Edit form submission
            editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const index = document.getElementById('editIndex').value;
                riskFactors[index].name = document.getElementById('factorName').value;
                riskFactors[index].inputValue = document.getElementById('inputValue').value;
                riskFactors[index].riskScore = parseInt(document.getElementById('riskScore').value);
                riskFactors[index].weight = parseFloat(document.getElementById('weight').value);
                
                closeModals();
                renderFactorsTable();
                calculateScores();
            });

            // Add factor form submission
            addFactorForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newFactor = {
                    name: document.getElementById('newFactorName').value,
                    inputValue: document.getElementById('newInputValue').value,
                    riskScore: parseInt(document.getElementById('newRiskScore').value),
                    weight: parseFloat(document.getElementById('newWeight').value),
                    weightedScore: 0
                };
                
                riskFactors.push(newFactor);
                closeModals();
                renderFactorsTable();
                calculateScores();
            });
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>